{"version":3,"sources":["assets/Common/UI/UIManager.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/typescript.html\n// Learn Attribute:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/life-cycle-callbacks.html\n\nimport BundleManager from \"../Bundle/BundleManager\";\nimport Game from \"../Game\";\nimport CCTools from \"../Tools/CCTools\";\nimport { UIView } from \"./UIView\";\n/**\n * UIManager界面管理类\n * \n * 1.打开界面，根据配置自动加载界面、调用初始化、播放打开动画、隐藏其他界面、屏蔽下方界面点击\n * 2.关闭界面，根据配置自动关闭界面、播放关闭动画、恢复其他界面\n * 3.切换界面，与打开界面类似，但是是将当前栈顶的界面切换成新的界面（先关闭再打开）\n * 4.提供界面缓存功能\n *\n */\n\n/** UI栈结构体 */\nexport interface UIInfo {\n    uiId: number;\n    uiView: UIView;\n    uiArgs: any;\n    preventNode?: cc.Node;\n    zOrder?: number;\n    openType?: 'quiet' | 'other';\n    isClose?: boolean;\n    resToClear?: string[];\n    resCache?: string[];\n}\n\n/** UI配置结构体 */\nexport interface UIConf {\n    prefab: string;\n    bundle?: string;\n    preventTouch?: boolean;\n}\n\nexport enum ScreenType {\n    Long,       //长屏\n    Short,      //短屏\n    Pad         //平板\n}\n\nexport class UIManager {\n    /** 资源加载计数器，用于生成唯一的资源占用key */\n    private useCount = 0;\n    /** 背景UI（有若干层UI是作为背景UI，而不受切换等影响）*/\n    private BackGroundUI = 0;\n    /** 是否正在关闭UI */\n    private isClosing = false;\n    /** 是否正在打开UI */\n    private isOpening = false;\n    private openingUIId: number;\n\n    /** UI界面缓存（key为UIId，value为UIView节点）*/\n    private UICache: { [UIId: number]: UIView } = {};\n    /** UI界面栈（{UIID + UIView + UIArgs}数组）*/\n    private UIStack: UIInfo[] = [];\n    /** UI待打开列表 */\n    private UIOpenQueue: UIInfo[] = [];\n    /** UI待关闭列表 */\n    private UICloseQueue: UIView[] = [];\n    /** UI配置 */\n    private UIConf: { [key: number]: UIConf } = {};\n\n    /** 所有UI层级 */\n    private layers: Map<string, Node> = new Map<string, Node>();\n    /** UI Root Canvas */\n    private uiRootCanvasNode: cc.Node;\n\n    /** UI打开前回调 */\n    public uiOpenBeforeDelegate: (uiId: number, preUIId: number) => void = null;\n    /** UI打开回调 */\n    public uiOpenDelegate: (uiId: number, preUIId: number) => void = null;\n    /** UI关闭回调 */\n    public uiCloseDelegate: (uiId: number) => void = null;\n\n    public screenType: ScreenType = ScreenType.Long;\n\n    /**\n     * 初始化所有UI的配置对象\n     * @param conf 配置对象\n     */\n    public initUIConf(conf: { [key: number]: UIConf }): void {\n        this.UIConf = conf;\n\n        let winSize = cc.view.getFrameSize();\n        let resolutionSize = cc.view.getDesignResolutionSize();\n\n        if (winSize.height / winSize.width < 1.77) {\n            // 平板\n            this.screenType = ScreenType.Pad;\n        } else if (winSize.height / winSize.width < 2) {\n            // 短手机\n            this.screenType = ScreenType.Short;\n        } else {\n            // 长屏幕手机\n            this.screenType = ScreenType.Long;\n        }\n    }\n\n    /**\n     * 设置或覆盖某uiId的配置\n     * @param uiId 要设置的界面id\n     * @param conf 要设置的配置\n     */\n    public setUIConf(uiId: number, conf: UIConf): void {\n        this.UIConf[uiId] = conf;\n    }\n\n    /****************** 私有方法，UIManager内部的功能和基础规则 *******************/\n\n    /**\n     * 添加防触摸层\n     * @param zOrder 屏蔽层的层级\n     */\n    private preventTouch(zOrder: number) {\n        let child = cc.director.getScene().getChildByName('Canvas') as unknown as cc.Node;\n        let node = CCTools.addNode(child, 'preventTouch')\n        node.on(cc.Node.EventType.TOUCH_START, function (event: Event) {\n        }, node);\n        child.addChild(node);\n        return node;\n    }\n\n    /** 自动执行下一个待关闭或待打开的界面 */\n    private autoExecNextUI() {\n        // 逻辑上是先关后开\n        if (this.UICloseQueue.length > 0) {\n            let uiQueueInfo = this.UICloseQueue[0];\n            this.UICloseQueue.splice(0, 1);\n            this.close(uiQueueInfo);\n        } else if (this.UIOpenQueue.length > 0) {\n            let uiQueueInfo = this.UIOpenQueue[0];\n            this.UIOpenQueue.splice(0, 1);\n            this.open(uiQueueInfo.uiId, uiQueueInfo.uiArgs);\n        }\n    }\n\n    /**\n     * 自动检测动画组件以及特定动画，如存在则播放动画，无论动画是否播放，都执行回调\n     * @param aniName 动画名\n     * @param aniOverCallback 动画播放完成回调\n     */\n    private autoExecAnimation(uiView: UIView, aniName: string, aniOverCallback: () => void) {\n        // 暂时先省略动画播放的逻辑\n        if (uiView.getComponent(cc.Animation)) {\n            let ani = uiView.getComponent(cc.Animation);\n            ani.play(aniName);\n            ani.on('stop', () => {\n                aniOverCallback();\n            }, this);\n        } else {\n            aniOverCallback();\n        }\n    }\n\n    /**\n     * 自动检测资源预加载组件，如果存在则加载完成后调用completeCallback，否则直接调用\n     * @param completeCallback 资源加载完成回调\n     */\n    private autoLoadRes(uiView: UIView, completeCallback: () => void) {\n        // 暂时先省略\n        completeCallback();\n    }\n\n    /** 生成唯一的资源占用key */\n    private makeUseKey(): string {\n        return `UIMgr_${++this.useCount}`;\n    }\n\n\n    /**\n     * 异步加载一个UI的prefab，成功加载了一个prefab之后\n     * @param uiId 界面id\n     * @param processCallback 加载进度回调\n     * @param completeCallback 加载完成回调\n     * @param uiArgs 初始化参数\n     */\n    private getOrCreateUI(uiId: number, completeCallback: (uiView: UIView) => void, uiArgs: any): void {\n        // 如果找到缓存对象，则直接返回\n        let uiView: UIView = this.UICache[uiId];\n        if (uiView) {\n            completeCallback(uiView);\n            return;\n        }\n\n        // 找到UI配置\n        let uiPath = this.UIConf[uiId].prefab;\n        let uiBundle: cc.AssetManager.Bundle = null;\n        if (null == uiPath) {\n            completeCallback(null);\n            return;\n        }\n\n        this.makeUseKey();\n        let complete = () => {\n            (uiBundle ? uiBundle : cc.resources).load(uiPath, (err: Error, prefab: cc.Prefab) => {\n                // 检查加载资源错误\n                if (err) {\n                    // Log.print(`getOrCreateUI loadRes ${uiId} faile, path: ${uiPath} error: ${err}`);\n                    // completeCallback(null);\n                    BundleManager.load(uiPath, (err: Error, prefab: cc.Prefab) => {\n                        if (err) {\n                            console.error(`getOrCreateUI loadRes ${uiId} faile, path: ${uiPath} error: ${err}`);\n                            completeCallback(null);\n                        } else {\n                            this.compleateCreateUI(uiId, uiPath, uiView, prefab, completeCallback, uiArgs);\n                        }\n                    });\n                } else {\n                    this.compleateCreateUI(uiId, uiPath, uiView, prefab, completeCallback, uiArgs);\n                }\n            });\n        }\n        if (this.UIConf[uiId].bundle) {\n            if (App.bundles.get(this.UIConf[uiId].bundle)) {\n                uiBundle = App.bundles.get(this.UIConf[uiId].bundle);\n                complete();\n            } else {\n                cc.assetManager.loadBundle(this.UIConf[uiId].bundle, (err, bundle) => {\n                    if (!err) {\n                        App.bundles.set(this.UIConf[uiId].bundle, bundle);\n                        uiBundle = bundle;\n                        complete();\n                    };\n                })\n            }\n        } else {\n            complete();\n        }\n    }\n\n    private compleateCreateUI(uiId: number, uiPath: string, uiView: UIView, prefab: Prefab, completeCallback: (uiView: UIView) => void, uiArgs: any) {\n        // 检查实例化错误\n        let uiNode: Node = instantiate(prefab);\n        if (null == uiNode) {\n            Log.print(`getOrCreateUI instantiate ${uiId} faile, path: ${uiPath}`);\n            completeCallback(null);\n            // resLoader.release(prefab);\n            return;\n        }\n        // 检查组件获取错误\n        uiView = uiNode.getComponent(UIView);\n        // 设置一下uiId\n        uiView.uiId = uiId;\n        if (null == uiView) {\n            Log.print(`getOrCreateUI getComponent ${uiId} faile, path: ${uiPath}`);\n            uiNode.destroy();\n            completeCallback(null);\n            // resLoader.release(prefab);\n            return;\n        }\n        // 异步加载UI预加载的资源\n        this.autoLoadRes(uiView, () => {\n            uiView.init(uiArgs);\n            completeCallback(uiView);\n            // uiView.cacheAsset(prefab);\n        })\n    }\n\n    /**\n     * UI被打开时回调，对UI进行初始化设置，刷新其他界面的显示，并根据\n     * @param uiId 哪个界面被打开了\n     * @param uiView 界面对象\n     * @param uiInfo 界面栈对应的信息结构\n     * @param uiArgs 界面初始化参数\n     */\n    private onUIOpen(uiId: number, uiView: UIView, uiInfo: UIInfo, uiArgs: any) {\n        if (null == uiView) {\n            return;\n        }\n        // 激活界面\n        uiInfo.uiView = uiView;\n        uiView.node.active = true;\n        //uiView.node.zIndex = uiInfo.zOrder || this.UIStack.length;\n\n        // 快速关闭界面的设置，绑定界面中的background，实现快速关闭\n        if (uiView.quickClose) {\n            let backGround = uiView.node.getChildByName('background');\n            if (!backGround) {\n                Utils.addNode(uiView.node, 'background');\n            }\n            backGround.targetOff(Node.EventType.TOUCH_START);\n            backGround.on(Node.EventType.TOUCH_START, (event: Event) => {\n                this.close(uiView);\n            }, backGround);\n        }\n\n        // 添加到场景中\n        let child = director.getScene().getChildByName('Canvas');\n        let nodeName = ''\n        switch (uiView.showType) {\n            case UIShowTypes.UIFullScreen:\n                nodeName = 'bottom';\n                break;\n            case UIShowTypes.UIAddition:\n                nodeName = 'middle';\n                break;\n            case UIShowTypes.UISingle:\n                nodeName = 'top';\n                break;\n            default:\n                break;\n        }\n        child = director.getScene().getChildByName('Canvas').getChildByName(nodeName);\n        child.addChild(uiView.node);\n\n        if (!GlobalConfig.isRelease) {\n            let time = new Date().toLocaleString();\n            Log.print(\"%c[open-view %s]>>> %s\", \"color:blue\", time, uiInfo.uiView.name);\n        }\n\n        // 刷新其他UI\n        this.updateUI();\n\n        // 从那个界面打开的\n        let fromUIID = 0;\n        if (this.UIStack.length > 1) {\n            fromUIID = this.UIStack[this.UIStack.length - 2].uiId\n        }\n\n        // 打开界面之前回调\n        if (this.uiOpenBeforeDelegate) {\n            this.uiOpenBeforeDelegate(uiId, fromUIID);\n        }\n\n        //阿拉伯语处理\n        if (App.isAr()) {\n            this.arabicUI(uiView.node);\n        }\n\n        // 执行onOpen回调\n        uiView.onOpen(fromUIID, uiArgs);\n        this.autoExecAnimation(uiView, \"uiOpen\", () => {\n            uiView.onOpenAniOver();\n            if (this.uiOpenDelegate) {\n                this.uiOpenDelegate(uiId, fromUIID);\n            }\n        });\n    }\n\n    /** 打开界面并添加到界面栈中 */\n    public open(uiId: number, uiArgs: any = null): void {\n        let uiInfo: UIInfo = {\n            uiId: uiId,\n            uiArgs: uiArgs,\n            uiView: null,\n        };\n\n        if (this.isOpening || this.isClosing) {\n            if (this.isOpening && this.openingUIId === uiId) {\n                console.error(`界面${uiId}已经在打开中`);\n                return;\n            }\n\n            // 插入待打开队列\n            if (this.UIOpenQueue.find((obj) => { return obj.uiId === uiInfo.uiId; }) != null) {\n                console.error(`界面${uiId}已经在排队中`);\n                return;\n            }\n\n            console.error(`界面${uiId}插入打开队列`);\n            this.UIOpenQueue.push(uiInfo);\n            return;\n        }\n\n        let uiIndex = this.getUIIndex(uiId);\n        if (-1 != uiIndex) {\n            // 重复打开了同一个界面，直接回到该界面\n            console.error(`重复打开界面${uiId}`);\n            this.closeToUI(uiId, uiArgs);\n            return;\n        }\n\n        // 设置UI的zOrder\n        uiInfo.zOrder = (uiArgs && uiArgs.zOrder) || this.UIStack.length + 1;\n        console.log(uiInfo.zOrder)\n        this.UIStack.push(uiInfo);\n\n        // 先屏蔽点击\n        if (this.UIConf[uiId]?.preventTouch) {\n            uiInfo.preventNode = this.preventTouch(uiInfo.zOrder);\n        }\n\n        this.isOpening = true;\n        this.openingUIId = uiId;\n        // 预加载资源，并在资源加载完成后自动打开界面\n        this.getOrCreateUI(uiId, (uiView: UIView): void => {\n            // 如果界面已经被关闭或创建失败\n            if (uiInfo.isClose || null == uiView) {\n                Log.print(`getOrCreateUI ${uiId} faile!\n                        close state : ${uiInfo.isClose} , uiView : ${uiView}`);\n                this.isOpening = false;\n                this.openingUIId = null;\n                if (uiInfo.preventNode) {\n                    uiInfo.preventNode.destroy();\n                    uiInfo.preventNode = null;\n                }\n                return;\n            }\n\n            // 打开UI，执行配置\n            // 逻辑层函数异常处理,防止卡主ui queue\n            try {\n                this.onUIOpen(uiId, uiView, uiInfo, uiArgs);\n                if (uiInfo.uiArgs != null && uiInfo.uiArgs.onOpenCallback != null) {\n                    uiInfo.uiArgs.onOpenCallback(uiView);\n                }\n            } catch (error) {\n                Log.error(error)\n            }\n\n            this.isOpening = false;\n            this.openingUIId = null;\n            this.autoExecNextUI();\n        }, uiArgs);\n    }\n\n    /** 替换栈顶界面 */\n    public replace(uiId: number, uiArgs: any = null) {\n        this.close(this.UIStack[this.UIStack.length - 1].uiView);\n        this.open(uiId, uiArgs);\n    }\n\n    /**\n     * 根据uiid关闭界面\n     * @param uiId \n     */\n    public closeById(uiId: number) {\n        let uiView = this.getUI(uiId);\n        if (uiView) {\n            this.close(uiView);\n        }\n    }\n\n    /**\n     * 关闭当前界面\n     * @param closeUI 要关闭的界面\n     */\n    public close(closeUI?: UIView) {\n        let uiCount = this.UIStack.length;\n        if (uiCount < 1 || this.isClosing || this.isOpening) {\n            if (closeUI) {\n                // 插入待关闭队列\n                if (this.UICloseQueue.find((obj) => { return obj.uiId === closeUI.uiId }) != null) {\n                    Log.print(`${closeUI.uiId} 已在等待关闭中`);\n                    return;\n                }\n                this.UICloseQueue.push(closeUI);\n            }\n            return;\n        }\n\n        let uiInfo: UIInfo;\n        if (closeUI) {\n            for (let index = this.UIStack.length - 1; index >= 0; index--) {\n                let ui = this.UIStack[index];\n                if (ui.uiView === closeUI) {\n                    uiInfo = ui;\n                    this.UIStack.splice(index, 1);\n                    break;\n                }\n            }\n            // 找不到这个UI\n            if (uiInfo === undefined) {\n                return;\n            }\n        } else {\n            uiInfo = this.UIStack.pop();\n        }\n\n        // 关闭当前界面\n        let uiId = uiInfo.uiId;\n        let uiView = uiInfo.uiView;\n        uiInfo.isClose = true;\n\n        // 回收遮罩层\n        if (uiInfo.preventNode) {\n            uiInfo.preventNode.destroy();\n            uiInfo.preventNode = null;\n        }\n\n        if (null == uiView) {\n            return;\n        }\n\n        let preUIInfo = this.UIStack[uiCount - 2];\n        // 处理显示模式\n        this.updateUI();\n        let close = () => {\n            this.isClosing = false;\n            // 显示之前的界面\n            if (preUIInfo && preUIInfo.uiView && this.isTopUI(preUIInfo.uiId)) {\n                // 如果之前的界面弹到了最上方（中间有肯能打开了其他界面）\n                preUIInfo.uiView.node.active = true\n                // 回调onTop\n                preUIInfo.uiView.onTop(uiId, uiView.onClose());\n            } else {\n                uiView.onClose();\n            }\n\n            if (this.uiCloseDelegate) {\n                this.uiCloseDelegate(uiId);\n            }\n            if (uiView.cache) {\n                this.UICache[uiId] = uiView;\n                uiView.node.removeFromParent();\n                Log.print(`uiView removeFromParent ${uiInfo.uiId}`);\n            } else {\n                uiView.node.destroy();\n                if (!GlobalConfig.isRelease) {\n                    let time = new Date().toLocaleString();\n                    Log.print(\"%c[close-view %s]>>> %s\", \"color:gray\", time, uiInfo.uiView.name);\n                }\n            }\n            this.autoExecNextUI();\n        }\n        // 执行关闭动画\n        this.autoExecAnimation(uiView, \"uiClose\", close);\n    }\n\n    /** 关闭所有界面 */\n    public closeAll() {\n        // 不播放动画，也不清理缓存\n        for (const uiInfo of this.UIStack) {\n            uiInfo.isClose = true;\n            if (uiInfo.preventNode) {\n                uiInfo.preventNode.destroy();\n                uiInfo.preventNode = null;\n            }\n            if (uiInfo.uiView) {\n                uiInfo.uiView.onClose();\n                uiInfo.uiView.node.destroy();\n            }\n        }\n        this.UIOpenQueue = [];\n        this.UICloseQueue = [];\n        this.UIStack = [];\n        this.isOpening = false;\n        this.openingUIId = null;\n        this.isClosing = false;\n    }\n\n    /**\n     * 关闭界面，一直关闭到顶部为uiId的界面，为避免循环打开UI导致UI栈溢出\n     * @param uiId 要关闭到的uiId（关闭其顶部的ui）\n     * @param uiArgs 打开的参数\n     * @param bOpenSelf \n     */\n    public closeToUI(uiId: number, uiArgs: any, bOpenSelf = true): void {\n        let idx = this.getUIIndex(uiId);\n        if (-1 == idx) {\n            return;\n        }\n\n        idx = bOpenSelf ? idx : idx + 1;\n        for (let i = this.UIStack.length - 1; i >= idx; --i) {\n            let uiInfo = this.UIStack.pop();\n            let uiId = uiInfo.uiId;\n            let uiView = uiInfo.uiView;\n            uiInfo.isClose = true\n\n            // 回收屏蔽层\n            if (uiInfo.preventNode) {\n                uiInfo.preventNode.destroy();\n                uiInfo.preventNode = null;\n            }\n\n            if (this.uiCloseDelegate) {\n                this.uiCloseDelegate(uiId);\n            }\n\n            if (uiView) {\n                uiView.onClose()\n                if (uiView.cache) {\n                    this.UICache[uiId] = uiView;\n                    uiView.node.removeFromParent();\n                } else {\n                    uiView.node.destroy();\n                }\n            }\n        }\n\n        this.updateUI();\n        this.UIOpenQueue = [];\n        this.UICloseQueue = [];\n        bOpenSelf && this.open(uiId, uiArgs);\n    }\n\n    /** 清理界面缓存 */\n    public clearCache(): void {\n        for (const key in this.UICache) {\n            let ui = this.UICache[key];\n            if (isValid(ui.node)) {\n                ui.node.destroy();\n            }\n        }\n        this.UICache = {};\n    }\n\n    /******************** UI的便捷接口 *******************/\n    public isTopUI(uiId): boolean {\n        if (this.UIStack.length == 0) {\n            return false;\n        }\n        return this.UIStack[this.UIStack.length - 1].uiId == uiId;\n    }\n\n    public getUI(uiId: number): UIView {\n        for (let index = 0; index < this.UIStack.length; index++) {\n            const element = this.UIStack[index];\n            if (uiId == element.uiId) {\n                return element.uiView;\n            }\n        }\n        return null;\n    }\n\n    public getTopUI(): UIView {\n        if (this.UIStack.length > 0) {\n            return this.UIStack[this.UIStack.length - 1].uiView;\n        }\n        return null;\n    }\n\n    public getUIIndex(uiId: number): number {\n        for (let index = 0; index < this.UIStack.length; index++) {\n            const element = this.UIStack[index];\n            if (uiId == element.uiId) {\n                return index;\n            }\n        }\n        return -1;\n    }\n\n    public initialize() {\n        this.layers = new Map<string, Node>();\n        this.uiRootCanvasNode = director.getScene().getChildByName('Canvas');\n        let designSize = this.uiRootCanvasNode.getComponent(cc.Canvas).designResolution;\n        uiLayers.forEach((layer) => {\n            if (this.layers[layer.layerName] == null) {\n                let layerNode = new Node(layer.layerName);\n                this.layers[layer.layerName] = layerNode;\n                let widget = layerNode.addComponent(Widget);\n                this.uiRootCanvasNode.addChild(layerNode);\n                layerNode.setContentSize(designSize);\n                widget.isAlignLeft = true;\n                widget.isAlignRight = true;\n                widget.isAlignBottom = true;\n                widget.isAlignTop = true;\n            }\n        });\n    }\n\n    // public addAudioRoot() {\n    //     //音效节点\n    //     let audioNode = new Node(\"audioNode\");\n    //     audioNode.addComponent(AudioSource)\n    //     audioNode.addComponent(audioRoot)\n    //     this.uiRootCanvasNode.addChild(audioNode)\n\n    // }\n}\n\nexport let uiManager: UIManager = new UIManager();\n"]}