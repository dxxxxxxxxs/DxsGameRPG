{"version":3,"sources":["assets/Scripts/Game/GameManager.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/typescript.html\n// Learn Attribute:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/life-cycle-callbacks.html\n\nimport BundleManager from \"../../Common/Bundle/BundleManager\";\nimport Game from \"../../Common/Game\";\nimport GameModel from \"../Model/GameModel\";\nimport GameConst from \"../Src/GameConst\";\nimport { GameState } from \"../UI/UIGame\";\n\nconst { ccclass, property } = cc._decorator;\n\n@ccclass\nexport default class GameManager extends cc.Component {\n    protected onLoad(): void {\n        cc.game.addPersistRootNode(this.node);\n        cc.director.getPhysicsManager().enabled = true;\n        cc.director.getCollisionManager().enabled = true;\n        this.addEvent();\n        this.initGameModel();\n        this.initBundle();\n    }\n\n    //初始化游戏数据\n    initGameModel() {\n        GameModel.gameWidth = cc.view.getVisibleSize().width;\n        GameModel.gameHeigth = cc.view.getVisibleSize().height;\n    }\n    initBundle() {\n        BundleManager.loadBundle(\"ObjectPool\");\n    }\n\n\n    addEvent() {\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\n        Game.Event.addEventListener(GameConst.GAMESTART, this.GameStart, this);\n        Game.Event.addEventListener(GameConst.GAMEOVER, this.GameOver, this);\n        Game.Event.addEventListener(GameConst.UI_BackStart, this.GameBackStart, this);\n        Game.Event.addEventListener(GameConst.GetCoin, this.GetCoin, this);\n    }\n    removeEvent() {\n        cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\n        Game.Event.removeEventListener(GameConst.GAMESTART, this.GameStart, this);\n        Game.Event.removeEventListener(GameConst.GAMEOVER, this.GameOver, this);\n        Game.Event.removeEventListener(GameConst.UI_BackStart, this.GameBackStart, this);\n        Game.Event.removeEventListener(GameConst.GetCoin, this.GetCoin, this);\n    }\n    onKeyDown(event: cc.Event.EventKeyboard) {\n        if (GameModel.gameState == GameState.pause) {\n            switch (event.keyCode) {\n                case cc.macro.KEY.p:\n                    this.onGamePause();\n                    break;\n            }\n            return;\n        }\n        if (GameModel.gameState != GameState.game) return;\n        switch (event.keyCode) {\n            case cc.macro.KEY.up:\n                Game.Event.dispatch(GameConst.UI_PlayerUp);\n                break;\n            case cc.macro.KEY.w:\n                Game.Event.dispatch(GameConst.UI_PlayerUp);\n                break;\n            case cc.macro.KEY.p:\n                this.onGamePause();\n                break;\n        }\n    }\n    GetCoin() {\n        GameModel.gameScore++;\n        Game.Event.dispatch(GameConst.UI_GetCoin);\n    }\n\n    /**\n     * 游戏开始\n     */\n    GameStart() {\n        GameModel.gameState = GameState.game;\n        cc.director.loadScene(\"Game\");\n        //this.initPlayer();\n    }\n    /**\n     * 游戏结束\n     */\n    GameOver() {\n        GameModel.gameScore = 0;\n        GameModel.gameState = GameState.over;\n        GameModel.distance = 0;\n        GameModel.moveSpeed = 200;\n        Game.ObjectPool.UnSpawnAll();\n        Game.ObjectPool.Clear();\n        Game.Event.dispatch(GameConst.UI_GameOver);\n    }\n    /**\n     * 返回主界面\n     */\n    GameBackStart() {\n        GameModel.gameState = GameState.null;\n        cc.director.loadScene(\"Start\");\n    }\n    /**\n     * 游戏暂停\n     */\n    onGamePause() {\n        if (GameModel.gameState == GameState.pause) {\n            GameModel.gameState = GameState.game;\n            cc.game.resume();\n        }\n        else if (GameModel.gameState) {\n            GameModel.gameState = GameState.pause;\n            cc.game.pause();\n        }\n    }\n}\n"]}